<html>
<head></head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script lang="js">
  async function run() {
    const trainingUrl = './data/wdbc-train.csv';

    // Specify the label column
    const trainingData = tf.data.csv(trainingUrl, {
      columnConfigs: {
        'diagnosis': {
          isLabel: true,
        },
      },
    });

    // Convert the training data into arrays
    const convertedTrainingData = trainingData
      .map(({ xs, ys }) => {
	  console.log(Number(ys.diagnosis))
        return {
          xs: Object.values(xs),
          ys: Number(ys.diagnosis),
        };
      })
      .batch(10)
      .map(({ xs, ys }) => {
        return {
          xs: xs,
          ys: ys.squeeze(), // Flatten labels to shape [batch_size]
        };
      });

    const testingUrl = './data/wdbc-test.csv';

    // Specify the label column in the testing data
    const testingData = tf.data.csv(testingUrl, {
      columnConfigs: {
        'diagnosis': {
          isLabel: true,
        },
      },
    });

    // Convert the testing data into arrays
    const convertedTestingData = testingData
      .map(({ xs, ys }) => {
        return {
          xs: Object.values(xs),
          ys: Number(ys.diagnosis),
        };
      })
      .batch(10)
      .map(({ xs, ys }) => {
        return {
          xs: xs,
          ys: ys.squeeze(), // Flatten labels to shape [batch_size]
        };
      });

    // Specify the number of features
    const numOfFeatures = 30;

    // Create the neural network model
    const model = tf.sequential();

    model.add(
      tf.layers.dense({
        inputShape: [numOfFeatures],
        units: 16,
        activation: 'relu',
      })
    );
    model.add(
      tf.layers.dense({
        units: 8,
        activation: 'relu',
      })
    );
    model.add(
      tf.layers.dense({
        units: 1,
        activation: 'sigmoid',
      })
    );

    // Compile the model
    model.compile({
      optimizer: 'rmsprop',
      loss: 'binaryCrossentropy',
      metrics: ['accuracy'],
    });

    // Train and save the model
    await model.fitDataset(convertedTrainingData, {
      epochs: 100,
      validationData: convertedTestingData,
      callbacks: {
        onEpochEnd: async (epoch, logs) => {
          console.log(
            'Epoch: ' + epoch + ' Loss: ' + logs.loss + ' Accuracy: ' + logs.acc
          );
        },
      },
    });
    await model.save('downloads://my_model');
  }
  run();
</script>
<body>
Test 2
</body>
</html>
